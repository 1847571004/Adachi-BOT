<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>genshin-wish</title>
    <script src="../../data/js/vue.min.js"></script>
    <script src="../../data/js/element-ui.js"></script>
    <link rel="stylesheet" href="../../data/css/theme-chalk.css">
</head>

<body>

    <div id="app">
        <img class="background-character" :src="imageCover">
        <upper :nickname="nickname"></upper>
        <div class="avatars-box" v-for="avatars in avatarsData">
            <middle :avatars="avatars"></middle>
        </div>
        <bottom :counterFive="counterFive" :counterUp="counterUp"></bottom>
    </div>


    <template id="upper">
        <div>
            <img class="background" src="../../data/image/module/info-upper.png" alt="ERROR" />
            <p class="uid"> {{nickname}} 的抽卡模拟</p>
        </div>
    </template>

    <template id="avatar-element">
        <div class="tooltip">
            <div class="root">
                <div class="image" :class="'star-'+String(avatar.star)">
                    <img :src="avatar.imageHead" />
                </div>
                <p v-text="avatar.name + (avatar.counter?'('+ avatar.counter +')':'') "></p>
                <span>
                    <svg v-for="(item, index) in avatar.star" :key="index" viewBox="0 0 1024 1024"
                        xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
                        <path
                            d="M1010.472488 456.651729c-70.155387 91.673101-196.587873 233.002466-196.587873 233.002465s21.135743 162.465107 35.141356 268.398469a50.929501 50.929501 0 0 1-77.285517 56.531746c-84.161-42.398809-217.596292-113.063492-245.734841-127.323752-28.011225 14.132936-161.446517 84.797619-252.737647 127.323752a54.621889 54.621889 0 0 1-84.288324-56.531746c14.132936-105.933361 35.141355-268.398469 35.141355-268.398469S90.685706 541.322023 13.527512 456.651729a60.351458 60.351458 0 0 1 42.144162-91.927749c105.296743-14.132936 266.74326-49.401616 266.74326-49.401616s91.29113-162.592431 140.056127-261.395662c28.138549-63.661876 49.146968-56.531746 56.149774-49.401616a98.293936 98.293936 0 0 1 42.144162 49.401616c56.149775 98.803231 140.056127 261.395662 140.056127 261.395662s161.446517 35.268679 266.74326 56.404422a53.730623 53.730623 0 0 1 42.144161 84.924943z m0 0"
                            fill="#FFCC32" />
                    </svg>
                </span>
            </div>
        </div>
    </template>

    <template id="middle">
        <div>
            <div class="box">
                <div class="avatar" v-for="avatar in avatars">
                    <avatar-element :avatar="avatar"></avatar-element>
                </div>
                <img class="backdrop" src="../../data/image/module/info-middle.png" alt="ERROR" />
            </div>
        </div>
    </template>

    <template id="bottom">
        <div>
            <div class="background">
                <img src="../../data/image/module/info-bottom.png" alt="ERROR" />
            </div>
        </div>
    </template>

    <script>
        const upper = {
            template: '#upper',
            props: ['nickname']
        };

        const AvatarElement = {
            template: '#avatar-element',
            props: {
                avatar: {
                    type: Object,
                    default() {
                        return {
                            star: 0,
                            image: "",
                            name: ""
                        }
                    }
                }
            }
        }

        const middle = {
            template: '#middle',
            props: {
                avatars: {
                    type: Array
                }
            },
            components: {
                AvatarElement
            }
        };

        const bottom = {
            template: '#bottom'
        };

        new Vue({
            el: '#app',
            data: {
                nickname: '',
                avatarsData: [],
                counterFive: 0,
                counterUp: 0,
                imageCover: ''
            },
            components: {
                upper,
                middle,
                bottom
            },
            methods: {
                cutArray(array, step) {
                    let newArray = [];
                    let index = 0, len = array.length;
                    while (index < len) {
                        newArray.push(array.slice(index, index += step));
                    }
                    return newArray;
                },
                readJSON(file, callback) {
                    fetch(file).then(res => {
                        return res.json().then(data => {
                            callback(data);
                        })
                    })
                }
            },
            mounted() {
                this.readJSON('../../data/cache/genshin-wish.json', res => {
                    this.nickname = res.nickname;
                    this.counterFive = res.data.counterFive;
                    this.counterUp = res.data.counterUp;
                    let avatarsList = res.data.data;
                    avatarsList.sort((x, y) => {
                        return y.star - x.star;
                    });
                    this.imageCover = avatarsList[0].imageFull;
                    this.avatarsData = this.cutArray(avatarsList, 5);
                });
            }
        });
    </script>

</body>

</html>

<style>
    * {
        margin: 0;
        padding: 0;
    }

    html {
        width: 1396px;
        height: 100%;
        font-family: GenshinUsedFont, monospace;
    }

    img {
        display: block;
    }

    #app{
        background-size: contain;
    }

    .background-character{
        right: 0px;
        position: fixed;
        height: 100%;
        width: auto;
        opacity: 0.5;
    }

    .uid {
        position: absolute;
        width: 500px;
        text-align: center;
        font-size: 36px;
        left: 448px;
        top: 50px;
        color: rgb(64, 64, 64);
    }

    .box {
        position: relative;
    }

    .avatar {
        display: inline-block;
        height: 243px;
        margin-right: 17px;
        margin-bottom: 8px;
    }

    .avatar:first-child {
        margin-left: 82px;
    }

    .backdrop {
        position: absolute;
        margin-top: -260px;
        z-index: -1;
    }

    .element {
        position: relative;
        top: 5px;
    }

    .element .profile {
        position: relative;
        z-index: 1;
        width: 133px;
        top: -218px;
        left: 13px;
    }

    .element .avatar-info {
        position: relative;
        font-size: 3px;
        z-index: 1;
        float: left;
        top: -208px;
        left: 34px;
        width: 91px;
        text-align: center;
    }

    .avatar-info p {
        display: inline-block;
    }

    .avatar-info .name {
        font-size: 18px;
        color: rgb(64, 64, 64);
    }

    .avatar-info .level {
        color: rgb(0, 176, 80);
        font-size: 16px;
        margin-right: 2px;
    }

    .avatar-info .star {
        color: rgb(255, 204, 50);
        font-size: 22px;
        margin-left: 2px;
    }

    @font-face {
        font-family: GenshinUsedFont;
        src: url("../../data/font/HYWenHei-85W.ttf");
    }

    .tooltip {
        display: block;
        outline: 0;
    }

    .tooltip {
        zoom: 2;
    }

    .root {
        flex-shrink: 0;
        margin: 10px;
        height: 100px;
        width: 100px;
        background: #f1f0eb;
        border-radius: 5px;
        overflow: hidden;
    }

    .root .image.star-1 {
        background: #8f8e8e;
    }

    .root .image.star-2 {
        background: #599478;
    }

    .root .image.star-3 {
        background: #598ead;
    }

    .root .image.star-4 {
        background: #b981ce;
    }

    .root .image.star-5 {
        background: #d28024;
    }

    .root .image {
        height: 80%;
        text-align: center;
        border-radius: 0 0 20%;
        overflow: hidden;
    }

    .root .image img {
        width: 100%;
        position: relative;
        top: 50%;
        transform: translateY(-50%);
    }

    .root span {
        position: relative;
        top: -32%;
        width: 100px;
        float: left;
        text-align: center;
    }

    .root span svg {
        height: 15px;
    }

    .root p {
        text-align: center;
    }
</style>